<!doctype html>
<html lang="zh-cn">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Grainé‡æ„è®°-API | LeeReindeer&#39;s blog</title>
    <meta property="og:title" content="Grainé‡æ„è®°-API - LeeReindeer&#39;s blog">
    <meta property="og:type" content="article">
    
    <meta property="article:published_time" content='2019-01-16T18:31:21&#43;08:00'>
    
    
    <meta property="article:modified_time" content='2019-01-16T18:31:21&#43;08:00'>
    
    <meta name="Keywords" content="">
    <meta name="description"
        content="
Grain æ˜¯æˆ‘å¤§ä¸€è‡ªå­¦ Android æ—¶å†™çš„ä¸€ä¸ªAppï¼Œæœ€ç»ˆå­¦æ ¡å…³é—­æœåŠ¡å™¨æ¥å£ï¼Œå’ã€‚
æœ€è¿‘å‘ç°äº†ä¸€ä¸ªæ–°çš„å¯ç”¨çš„ç½‘ç«™ï¼Œæ‰€ä»¥é‡æ„çš„æ—¶å€™åˆ°äº†ï¼Œåœ¨æ¡†æ¶çš„é€‰æ‹©ä¸Šæˆ‘ä¸€ç›´çº ç»“æ˜¯ç”¨ MVP è¿˜æ˜¯ MVVMï¼Œæœ€åè¿˜æ˜¯ç”¨äº† MVVM é…åˆ Google çš„ Jetpackï¼Œä½¿ç”¨èµ·æ¥å¾ˆå¥‡å¦™ï¼Œä¹Ÿæœ‰å¾ˆå¤šå‘ã€‚
ç›®å‰ App ç¡®å®šçš„å‡ ä¸ªåŠŸèƒ½æ˜¯ï¼šæŸ¥æˆç»©ã€æ ¡å›­å¡ã€å€Ÿé˜…æŸ¥è¯¢ã€‚

è¿™æ¬¡æˆ‘ç”¨çš„æ•°æ®æ¥æºæ˜¯å­¦æ ¡çš„å®˜ç½‘ï¼Œå¯ä»¥åœ¨å¤–ç½‘è®¿é—®ï¼Œè²Œä¼¼çŸ¥é“è¿™ä¸ªç½‘ç«™çš„åŒå­¦å¾ˆå°‘å•Šã€‚">
    
    <meta name="author" content="LeeR">
    <meta property="og:url" content="https://leer.moe/post/grain-refactor-1/">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    <link href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
    

    
    
</head>

<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://leer.moe/">
                        LeeReindeer&#39;s blog
                    </a>
                
                <p class="description">Dive in</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://leer.moe/">é¦–é¡µ</a>
                    
                    <a  href="https://leer.moe/archives/" title="å½’æ¡£">å½’æ¡£</a>
                    
                    <a  href="https://leer.moe/about/" title="å…³äº">å…³äº</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    <style type="text/css">
    .post-toc {
        position: fixed;
        width: 260px;
        margin-top: 1%;
        right: 8.5%;
         
        margin-right: 1%;
        padding: 5px 10px;
        font-size: 12px;
         
        border-radius: 5px;
        background-color: rgba(255, 255, 255, 0.98);
         
         
         
        word-wrap: break-word;
        line-height: 1.5;
         
         
         
        z-index: 999;
        cursor: pointer;
        max-height: 70%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .post-toc .post-toc-title {
        width: 100%;
        margin: 0 auto;
        font-size: 18px;
        font-weight: 400;
        text-transform: uppercase;
        text-align: center;
        color: #ba3925;
    }

    .post-toc .post-toc-content {
        font-size: 15px;
    }

    .post-toc .post-toc-content>nav>ul {
        margin: 10px 0;
    }

    .post-toc .post-toc-content ul {
        padding-left: 20px;
        list-style: square;
        margin: 0.5em;
        line-height: 1.8em;
    }

    .post-toc .post-toc-content ul ul {
        padding-left: 15px;
        display: none;
    }

    @media print,
    screen and (max-width:1057px) {
        .post-toc {
            display: none;
        }
    }
</style>
<div class="post-toc" style="position: absolute; top: 188px;">
    <h2 class="post-toc-title">Grainé‡æ„è®°-API</h2>
    <div class="post-toc-content">
        <nav id="TableOfContents">
  <ol>
    <li><a href="#ç›´æ¥å¯ç”¨çš„-api">ç›´æ¥å¯ç”¨çš„ API</a></li>
    <li><a href="#ç™»å½•å’Œç™»å‡º">ç™»å½•å’Œç™»å‡º</a>
      <ol>
        <li><a href="#åˆ†æ">åˆ†æ</a></li>
        <li><a href="#å®ç°">å®ç°</a></li>
      </ol>
    </li>
    <li><a href="#æˆç»©">æˆç»©</a></li>
    <li><a href="#æ ¡å›­å¡">æ ¡å›­å¡</a></li>
    <li><a href="#ç”¨æˆ·ä¿¡æ¯">ç”¨æˆ·ä¿¡æ¯</a></li>
  </ol>
</nav>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        var postToc = $(".post-toc");
        if (postToc.length) {
            
            
            
            

            var t = postToc.offset().top - 20,
                a = {
                    start: {
                        position: "absolute",
                        top: t
                    },
                    process: {
                        position: "fixed",
                        top: 20
                    },
                };
            $(window).scroll(function () {
                var e = $(window).scrollTop();
                e < t ? postToc.css(a.start) : postToc.css(a.process)
            })
        }
    })
</script>
    <article class="post">
        <header>
            <h1 class="post-title">Grainé‡æ„è®°-API</h1>
        </header>
        <date class="post-meta meta-date">
            2019å¹´1æœˆ16æ—¥
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category"><a href='https://leer.moe/categories/%E5%88%9B%E4%BD%9C%E9%9B%86'>åˆ›ä½œé›†</a></span>
            
        </div>
        
        
        <div class="post-meta">
            <span>|</span>
            <span class="meta-category">2599 words</span>
        </div>
        
        
        
        <div class="post-content">
            <blockquote>
<p>Grain æ˜¯æˆ‘å¤§ä¸€è‡ªå­¦ Android æ—¶å†™çš„ä¸€ä¸ªAppï¼Œæœ€ç»ˆå­¦æ ¡å…³é—­æœåŠ¡å™¨æ¥å£ï¼Œå’ã€‚
æœ€è¿‘å‘ç°äº†ä¸€ä¸ªæ–°çš„å¯ç”¨çš„<a href="http://portal.zjou.edu.cn/index.portal">ç½‘ç«™</a>ï¼Œæ‰€ä»¥é‡æ„çš„æ—¶å€™åˆ°äº†ï¼Œåœ¨æ¡†æ¶çš„é€‰æ‹©ä¸Šæˆ‘ä¸€ç›´çº ç»“æ˜¯ç”¨ MVP è¿˜æ˜¯ MVVMï¼Œæœ€åè¿˜æ˜¯ç”¨äº† MVVM é…åˆ Google çš„ Jetpackï¼Œä½¿ç”¨èµ·æ¥å¾ˆå¥‡å¦™ï¼Œä¹Ÿæœ‰å¾ˆå¤šå‘ã€‚</p>
<p>ç›®å‰ App ç¡®å®šçš„å‡ ä¸ªåŠŸèƒ½æ˜¯ï¼šæŸ¥æˆç»©ã€æ ¡å›­å¡ã€å€Ÿé˜…æŸ¥è¯¢ã€‚</p>
</blockquote>
<p>è¿™æ¬¡æˆ‘ç”¨çš„æ•°æ®æ¥æºæ˜¯å­¦æ ¡çš„å®˜ç½‘ï¼Œå¯ä»¥åœ¨å¤–ç½‘è®¿é—®ï¼Œè²Œä¼¼çŸ¥é“è¿™ä¸ªç½‘ç«™çš„åŒå­¦å¾ˆå°‘å•Šã€‚</p>
<h2 id="ç›´æ¥å¯ç”¨çš„-api">ç›´æ¥å¯ç”¨çš„ API</h2>
<p>å¯ä»¥é€šè¿‡POSTå’ŒGETç›´æ¥è·å–æ•°æ®çš„APIï¼Œä¸éœ€è¦é€šè¿‡è§£æHTMLï¼ˆæ ¡å›­å¡ä½™é¢å’Œå€Ÿé˜…æ•°æ®éƒ½éœ€è¦è§£æHTMLæ¥è·å–ï¼‰</p>
<ul>
<li>
<p>ç™»å½•</p>
<ul>
<li>POST</li>
<li><a href="https://my.zjou.edu.cn/cas/login?service=http%3A%2F%2Fportal.zjou.edu.cn%2Findex.portal">URL</a></li>
<li>å‚æ•°
<ul>
<li>authType &ldquo;0&rdquo;</li>
<li>username &ldquo;your id&rdquo;</li>
<li>password &ldquo;your password&rdquo;</li>
<li>lt &quot;&quot;</li>
<li>execution &ldquo;execution&rdquo;</li>
<li>_eventId  &ldquo;submit&rdquo;</li>
<li>randomStr &quot;&quot;</li>
</ul>
</li>
</ul>
</li>
<li>
<p>ç™»å‡º</p>
<ul>
<li>GET</li>
<li><a href="https://my.zjou.edu.cn/cas/logout?service=http://portal.zjou.edu.cn">URL</a></li>
</ul>
</li>
<li>
<p>æŸ¥è¯¢æˆç»©ï¼ˆä»¥ä¸‹éƒ½éœ€è¦Cookieï¼‰</p>
<ul>
<li><a href="http://portal.zjou.edu.cn/independent.portal?.lm=zhxsxfcj&amp;.ms=view&amp;action=cj&amp;.ir=true">URL</a></li>
<li>GET/POST</li>
<li>æ³¨æ„è¿”å›æ•°æ®çš„Content-Typeä¸ºtext/htmlï¼Œä½†å®é™…ä¸Šæ˜¯jsonæ•°æ®ï¼ˆ</li>
</ul>
</li>
<li>
<p>å­¦åˆ†</p>
<ul>
<li><a href="http://portal.zjou.edu.cn/independent.portal?.lm=zhxsxfcj&amp;.ms=view&amp;action=xf&amp;.ir=true">URL</a></li>
<li>GET/POST</li>
<li>æ³¨æ„è¿”å›æ•°æ®çš„Content-Typeä¸ºtext/htmlï¼Œä½†å®é™…ä¸Šæ˜¯jsonæ•°æ®ï¼ˆ</li>
</ul>
</li>
</ul>
<h2 id="ç™»å½•å’Œç™»å‡º">ç™»å½•å’Œç™»å‡º</h2>
<p>å¤§æ¦‚æœ€éš¾æå®šçš„å°±æ˜¯ç™»å½•äº†ï¼Œé€šè¿‡ Chrome æŠ“åŒ…æ¥çœ‹æ˜¯ä½¿ç”¨ cookie + session çš„æ–¹å¼æ¥æ ¡éªŒç”¨æˆ·çš„ã€‚</p>
<h3 id="åˆ†æ">åˆ†æ</h3>
<p>
<a data-fancybox="gallery" href="/images/grain-login-post.png">
  <img class="mx-auto" alt="grain-login-post" src="/images/grain-login-post.png" />
</a>
</p>
<p>ç™»å½•æ˜¯ä¸€ä¸ªPOSTè¯·æ±‚ï¼Œè¡¨å•çš„å†…å®¹ä¹Ÿå¾ˆä¸€èˆ¬ï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯<code>excution</code>å­—æ®µï¼Œä¸€å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯ä¸€ä¸ªå›ºå®šçš„å­—æ®µï¼Œç»“æœå‘ç°å®ƒæ˜¯ä¼šâ€œé€’å¢â€çš„ã€‚å½“å‰æ˜¯<code>e1s1</code>ï¼Œä¸‹æ¬¡å†ä½¿ç”¨è¿™ä¸ª<code>session id</code> ç™»å½•ä¼šå˜æˆ<code>e2s1</code>ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<p><code>execution</code>æ˜¯ä¸€ä¸ªéšè—çš„å­—æ®µï¼Œæ‰€ä»¥å¯ä»¥å…ˆ<code>GET</code> è¿™ä¸ªç½‘é¡µï¼Œæ‹¿åˆ°éšè—å­—æ®µä¹‹åå†å‘èµ·<code>POST</code>è¯·æ±‚ç™»å½•ã€‚ç›¸ç­‰äºæ¨¡æ‹Ÿåœ¨æµè§ˆå™¨ä¸Šç™»å½•ä¸€æ ·ã€‚ï¼ˆä¸è¿‡ï¼Œå¦‚æœä½¿ç”¨æŸäº› User-agent ä¼šè§¦å‘éªŒè¯ç çš„æ ·å­ï¼Œè€Œä½¿ç”¨å…¶ä»–çš„å°±ä¸ä¼šï¼Œæ‰€ä»¥å½“ç„¶é€‰æ‹©ä¸è§¦å‘éªŒè¯ç çš„User-agentã€‚ã€‚ã€‚ï¼‰</p>
<p>å½“å¯†ç æˆ–è€…å­¦å·é”™è¯¯çš„æ—¶å€™ï¼Œä¼šè¿”å›ç™»å½•ç•Œé¢ï¼Œå¹¶ä¸”æœ‰é”™è¯¯æç¤ºï¼Œåœ¨idä¸º<code>status</code>çš„ div ä¸­ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®æœ‰æ— é”™è¯¯æç¤ºæ¥åˆ¤æ–­æ˜¯å¦ç™»å½•æˆåŠŸã€‚</p>
<p>
<a data-fancybox="gallery" href="/images/grain-login-error.png">
  <img class="mx-auto" alt="grain-login-error" src="/images/grain-login-error.png" />
</a>
</p>
<p>ç™»å‡ºå°±æ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦è®¿é—®</p>
<p><a href="">https://my.zjou.edu.cn/cas/logout?service=http://portal.zjou.edu.cn</a></p>
<p>å°±ä¼šæ¸…é™¤cookieå’Œsessionã€‚</p>
<h3 id="å®ç°">å®ç°</h3>
<p>ä½¿ç”¨<code>Okhttp</code> å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œç”¨ <code>Jsoup</code>æ¥è§£æHTMLï¼Œç”¨<code>Rxjava</code>æ¥å¤„ç†å¼‚æ­¥è°ƒç”¨ã€‚</p>
<h4 id="è·å–-execution">è·å– <code>execution</code></h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">    <span style="color:#000;font-weight:bold">fun</span> <span style="color:#900;font-weight:bold">getExecution</span>(): Observable&lt;String&gt; {
        <span style="color:#000;font-weight:bold">return</span> Observable.fromCallable {
            <span style="color:#000;font-weight:bold">val</span> response = httpClient.newCall(executionRequest).execute()
            <span style="color:#000;font-weight:bold">if</span> (!response.isSuccessful) {
                <span style="color:#d14">&#34;&#34;</span>
            } <span style="color:#000;font-weight:bold">else</span> {
                <span style="color:#000;font-weight:bold">val</span> respString = response.body()<span style="color:#000;font-weight:bold">!!</span>.string()
                <span style="color:#000;font-weight:bold">val</span> doc = Jsoup.parse(respString)
                <span style="color:#000;font-weight:bold">val</span> selected = doc.select(<span style="color:#d14">&#34;input[type=hidden]&#34;</span>)
                <span style="color:#000;font-weight:bold">val</span> executionNode = selected[<span style="color:#099">1</span>]
                <span style="color:#000;font-weight:bold">val</span> executionStr = executionNode.attr(<span style="color:#d14">&#34;value&#34;</span>)
                Log.d(TAG, <span style="color:#d14">&#34;onResponse: execution: </span><span style="color:#d14">$executionStr</span><span style="color:#d14">&#34;</span>)
                executionStr
            }
        }
            .subscribeOn(Schedulers.io())
            .observeOn(AndroidSchedulers.mainThread())
    }
</code></pre></div><h4 id="ç™»å½•">ç™»å½•</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * @param user user to login with is and password
</span><span style="color:#998;font-style:italic">     * @return return observable of login status code
</span><span style="color:#998;font-style:italic">     * @see LOGIN_NET_ERROR -1 -&gt; network error
</span><span style="color:#998;font-style:italic">     * @see LOGIN_ID_PASS_ERROR 0 -&gt; password error
</span><span style="color:#998;font-style:italic">     * @see LOGIN_SUCCESS 1 -&gt; success
</span><span style="color:#998;font-style:italic">     */</span>
    <span style="color:#000;font-weight:bold">fun</span> <span style="color:#900;font-weight:bold">login</span>(user: User, execution: String): Observable&lt;Int&gt; {
        <span style="color:#000;font-weight:bold">if</span> (execution.isEmpty()) {
            Log.e(TAG, <span style="color:#d14">&#34;getExecution failed&#34;</span>);
            <span style="color:#000;font-weight:bold">return</span> Observable.fromCallable { LOGIN_NET_ERROR }
        }
        <span style="color:#000;font-weight:bold">val</span> formBody = FormBody.Builder()
            .add(<span style="color:#d14">&#34;authType&#34;</span>, <span style="color:#d14">&#34;0&#34;</span>)
            .add(<span style="color:#d14">&#34;username&#34;</span>, user.id.toString())
            .add(<span style="color:#d14">&#34;password&#34;</span>, user.password)
            .add(<span style="color:#d14">&#34;lt&#34;</span>, <span style="color:#d14">&#34;&#34;</span>)
            .add(<span style="color:#d14">&#34;execution&#34;</span>, execution)
            .add(<span style="color:#d14">&#34;_eventId&#34;</span>, <span style="color:#d14">&#34;submit&#34;</span>)
            .add(<span style="color:#d14">&#34;randomStr&#34;</span>, <span style="color:#d14">&#34;&#34;</span>)
            .build()
        <span style="color:#000;font-weight:bold">val</span> loginRequest = Request.Builder()
            .url(<span style="color:#d14">&#34;https://my.zjou.edu.cn/cas/login?service=http%3A%2F%2Fportal.zjou.edu.cn%2Findex.portal&#34;</span>)
            .header(<span style="color:#d14">&#34;User-Agent&#34;</span>, USER_AGENT)
            .post(formBody)
            .build()

        <span style="color:#000;font-weight:bold">return</span> Observable.fromCallable {
            <span style="color:#000;font-weight:bold">val</span> response = httpClient.newCall(loginRequest).execute()
            Log.d(TAG, <span style="color:#d14">&#34;login: respose code: </span><span style="color:#d14">${response.code()}</span><span style="color:#d14">&#34;</span>)
            <span style="color:#000;font-weight:bold">val</span> doc = Jsoup.parse(response.body()<span style="color:#000;font-weight:bold">?.</span>string())
            <span style="color:#998;font-style:italic">// password or ID error
</span><span style="color:#998;font-style:italic"></span>            <span style="color:#000;font-weight:bold">val</span> statusDiv = doc.getElementById(<span style="color:#d14">&#34;status&#34;</span>)
            <span style="color:#000;font-weight:bold">if</span> (statusDiv <span style="color:#000;font-weight:bold">!=</span> <span style="color:#000;font-weight:bold">null</span>) {
                LOGIN_ID_PASS_ERROR
            } <span style="color:#000;font-weight:bold">else</span> { <span style="color:#998;font-style:italic">// login succeed, redirect to home page
</span><span style="color:#998;font-style:italic"></span>                LOGIN_SUCCESS
            }
        }
            .subscribeOn(Schedulers.io())
            .observeOn(AndroidSchedulers.mainThread())
    }
</code></pre></div><p><code>login</code>æ–¹æ³•éœ€è¦ç”¨æˆ·idã€å¯†ç å’Œ<code>execution</code>ã€‚æ‰€ä»¥éœ€è¦åœ¨ç™»å½•ä¹‹å‰å…ˆè·å–<code>execution</code>ï¼Œè·å–æˆåŠŸä¹‹åæ‰ä¼šç™»å½•ã€‚</p>
<h4 id="ç™»å‡º">ç™»å‡º</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">    <span style="color:#000;font-weight:bold">fun</span> <span style="color:#900;font-weight:bold">logoutAsync</span>(callback: Callback) {
        <span style="color:#000;font-weight:bold">val</span> logoutRequest = Request.Builder()
            .url(<span style="color:#d14">&#34;https://my.zjou.edu.cn/cas/logout?service=http://portal.zjou.edu.cn&#34;</span>)
            .header(<span style="color:#d14">&#34;User-Agent&#34;</span>, USER_AGENT)
            .<span style="color:#000;font-weight:bold">get</span>()
            .build()
        httpClient.newCall(logoutRequest).enqueue(callback)
    }
</code></pre></div><p><code>logout</code>æ²¡æœ‰è¿”å›<code>Rxjava</code>çš„<code>Observable</code>ï¼Œè€Œæ˜¯ä¼ å…¥<code>okhttp3.Callback</code>ï¼Œ<code>Callback</code>ä¸­çš„æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œä¸åœ¨ä¸»çº¿ç¨‹ã€‚å…¶å®æ•ˆæœå’Œ<code>Rxjava</code>å·®ä¸å¤šï¼Œè¿”å›çš„<code>Observable</code>å¯ä»¥<code>subscribe</code>ä¸€ä¸ª<code>Observer</code>ã€‚åœ¨<code>Observable</code>ä¸­å¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œåœ¨<code>Observer</code>ä¸­å¤„ç†ç»“æœã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">observable
	.subscribeOn(Schedulers.io()) <span style="color:#998;font-style:italic">// Observable è¿è¡Œåœ¨ IO çº¿ç¨‹
</span><span style="color:#998;font-style:italic"></span>	.observeOn(AndroidSchedulers.mainThread()) <span style="color:#998;font-style:italic">// Observer è¿è¡Œåœ¨ Main çº¿ç¨‹
</span></code></pre></div><p>æˆ‘ä¸ªäººæ¯”è¾ƒå–œæ¬¢<code>Rxjava</code>çš„é“¾å¼è°ƒç”¨ã€‚</p>
<h2 id="æˆç»©">æˆç»©</h2>
<p>è§£å†³äº†ç™»å½•é—®é¢˜ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„é—®é¢˜éƒ½ä¸æ˜¯é—®é¢˜äº†ï¼ˆ</p>
<p>è¿”å›æ•°æ®çš„Content-Typeä¸ºtext/htmlï¼Œä½†å®é™…ä¸Šå°±æ˜¯jsonæ•°æ®ï¼Œè¿™ä¹Ÿå¤ªåƒåœ¾äº†å§ï¼ˆæçš„æˆ‘è¦æ‰‹åŠ¨å»è§£æã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">    <span style="color:#000;font-weight:bold">fun</span> <span style="color:#900;font-weight:bold">getTranscript</span>(): Observable&lt;MutableList&lt;Transcript&gt;?&gt; {
        <span style="color:#000;font-weight:bold">return</span> Observable.fromCallable {
            <span style="color:#000;font-weight:bold">val</span> response = httpClient.newCall(transcriptRequest).execute()
            Log.d(TAG, <span style="color:#d14">&#34;onResponse: code: </span><span style="color:#d14">${response.code()}</span><span style="color:#d14">&#34;</span>)
            <span style="color:#000;font-weight:bold">val</span> resp = response.body()<span style="color:#000;font-weight:bold">?.</span>string()
            <span style="color:#000;font-weight:bold">if</span> (resp<span style="color:#000;font-weight:bold">?.</span>startsWith(<span style="color:#d14">&#34;{&#34;</span>) <span style="color:#000;font-weight:bold">==</span> <span style="color:#000;font-weight:bold">true</span>) {
                Log.d(TAG, <span style="color:#d14">&#34;onResponse: </span><span style="color:#d14">$resp</span><span style="color:#d14">&#34;</span>)
                <span style="color:#000;font-weight:bold">val</span> transcriptResponse = Gson().parseJson&lt;TranscriptResponse&gt;(resp)
                transcriptResponse<span style="color:#000;font-weight:bold">?.</span>transcriptList
            } <span style="color:#000;font-weight:bold">else</span> {
                ArrayList&lt;Transcript&gt;()
            }
        }
            .subscribeOn(Schedulers.io())
            .observeOn(AndroidSchedulers.mainThread())
    }
</code></pre></div><hr>
<p>å‰©ä¸‹çš„æ ¡å›­å¡å’Œå€Ÿé˜…çš„æ•°æ®éœ€è¦ç”¨<code>Jsoup</code>è§£æHTMLå»è·å–ï¼Œä¸‹å›å†å†™ã€‚</p>
<blockquote>
<p>2019.1.30 æ›´æ–°</p>
</blockquote>
<h2 id="æ ¡å›­å¡">æ ¡å›­å¡</h2>
<p>
<a data-fancybox="gallery" href="/images/ecard-request.png">
  <img class="mx-auto" alt="ecard-request" src="/images/ecard-request.png" />
</a>
</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">    <span style="color:#998;font-style:italic">/**
</span><span style="color:#998;font-style:italic">     * @param pageIndex page start from 1
</span><span style="color:#998;font-style:italic">     */</span>
    <span style="color:#000;font-weight:bold">fun</span> <span style="color:#900;font-weight:bold">getECardList</span>(pageIndex: Int, pageSize: Int): Observable&lt;ArrayList&lt;ECard&gt;?&gt; {
        <span style="color:#000;font-weight:bold">val</span> form = FormBody.Builder()
            .add(<span style="color:#d14">&#34;pageIndex&#34;</span>, pageIndex.toString())
            .add(<span style="color:#d14">&#34;pageSize&#34;</span>, pageSize.toString())
            .build()
        <span style="color:#000;font-weight:bold">val</span> request = Request.Builder()
            .url(<span style="color:#d14">&#34;http://portal.zjou.edu.cn/independent.portal?.cs=ZHxjb20uZWR1LmRrLnN0YXJnYXRlLnBvcnRhbC5jb250YWluZXIuY29yZS5pbXBsLlBvcnRsZXRFbnRpdHlXaW5kb3d8aW50ZS1qeXh4fHZpZXd8bm9ybWFsfHBtX2ludGUtanl4eF9hY3Rpb249cXVlcnlKeXh4fHJtX3xwcm1f&#34;</span>)
            .header(<span style="color:#d14">&#34;User-Agent&#34;</span>, USER_AGENT)
            .post(form)
            .build()

        <span style="color:#000;font-weight:bold">return</span> Observable.fromCallable {
            <span style="color:#000;font-weight:bold">val</span> response = httpClient.newCall(request).execute()
            <span style="color:#000;font-weight:bold">if</span> (!response.isSuccessful <span style="color:#000;font-weight:bold">||</span> response.body() <span style="color:#000;font-weight:bold">==</span> <span style="color:#000;font-weight:bold">null</span>) {
                ArrayList()
            } <span style="color:#000;font-weight:bold">else</span> {
                parseCardTable(response.body()<span style="color:#000;font-weight:bold">!!</span>.string())
            }
        }
            .subscribeOn(Schedulers.io())
            .observeOn(AndroidSchedulers.mainThread())
    }
</code></pre></div><p>æ ¡å›­å¡çš„æ¶ˆè´¹è®°å½•æ˜¯ä¸€ä¸ªè¡¨å• post è¯·æ±‚ï¼Œresponse æ˜¯ htmlã€‚ã€‚ã€‚å¤§æ¦‚æ˜¯æ²¡æœ‰åšä¸“é—¨çš„ RESTful API å§ã€‚æ‰€ä»¥åªèƒ½ä½¿ç”¨ Jsoup è§£æè¡¨æ ¼ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€æ®µ HTML è¡¨æ ¼ä»£ç çš„æˆªå–ï¼šç¬¬ä¸€ä¸ª<code>tr</code>æ ‡ç­¾æ˜¯è¡¨å¤´ï¼Œä¸éœ€è¦ã€‚ä»ç¬¬äºŒä¸ª<code>tr</code>å¼€å§‹æå–æˆ‘ä»¬æƒ³è¦çš„<code>td</code>ï¼Œç»„æˆæ¯ä¸€é¡¹æ¶ˆè´¹è®°å½•ã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#000080">table</span> <span style="color:#008080">isscroll</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;false&#34;</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;portlet-table&#34;</span> <span style="color:#008080">id</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;queryGridPluto_inte_jyxx_&#34;</span>&gt;
&lt;<span style="color:#000080">thead</span>&gt;
&lt;<span style="color:#000080">tr</span>&gt;
&lt;<span style="color:#000080">th</span>&gt;å¡å·&lt;/<span style="color:#000080">th</span>&gt;
&lt;<span style="color:#000080">th</span>&gt;äº¤æ˜“æµæ°´å·&lt;/<span style="color:#000080">th</span>&gt;
&lt;<span style="color:#000080">th</span>&gt;äº¤æ˜“æ—¶é—´&lt;/<span style="color:#000080">th</span>&gt;
&lt;<span style="color:#000080">th</span>&gt;å•†æˆ·ä»£ç &lt;/<span style="color:#000080">th</span>&gt;
&lt;<span style="color:#000080">th</span>&gt;äº¤æ˜“ç±»å‹&lt;/<span style="color:#000080">th</span>&gt;
&lt;<span style="color:#000080">th</span>&gt;äº¤æ˜“é‡‘é¢&lt;/<span style="color:#000080">th</span>&gt;
&lt;<span style="color:#000080">th</span>&gt;äº¤æ˜“ä½™é¢&lt;/<span style="color:#000080">th</span>&gt;&lt;/<span style="color:#000080">tr</span>&gt;&lt;/<span style="color:#000080">thead</span>&gt;
&lt;<span style="color:#000080">tbody</span>&gt;
&lt;<span style="color:#000080">tr</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;odd&#34;</span>&gt;
&lt;<span style="color:#000080">td</span> <span style="color:#008080">style</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;width:10%;&#34;</span>&gt;57016&lt;/<span style="color:#000080">td</span>&gt;
&lt;<span style="color:#000080">td</span> <span style="color:#008080">style</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;width:10%;&#34;</span>&gt;219171082&lt;/<span style="color:#000080">td</span>&gt;
&lt;<span style="color:#000080">td</span> <span style="color:#008080">style</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;width:6%;&#34;</span>&gt;2019-01-12 11:41:05&lt;/<span style="color:#000080">td</span>&gt;
&lt;<span style="color:#000080">td</span> <span style="color:#008080">style</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;width:6%;&#34;</span>&gt;é•¿å³™å­¦ç”Ÿå®¿èˆP&lt;/<span style="color:#000080">td</span>&gt;
&lt;<span style="color:#000080">td</span> <span style="color:#008080">style</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;width:10%;&#34;</span>&gt;æ”¶è´¹å†²æ­£&lt;/<span style="color:#000080">td</span>&gt;
&lt;<span style="color:#000080">td</span> <span style="color:#008080">style</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;width:8%;&#34;</span>&gt;4.69&lt;/<span style="color:#000080">td</span>&gt;
&lt;<span style="color:#000080">td</span> <span style="color:#008080">style</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;width:8%;&#34;</span>&gt;43.3&lt;/<span style="color:#000080">td</span>&gt;&lt;/<span style="color:#000080">tr</span>&gt;
&lt;<span style="color:#000080">tr</span> <span style="color:#008080">class</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;even&#34;</span>&gt;
&lt;<span style="color:#000080">td</span> <span style="color:#008080">style</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;width:10%;&#34;</span>&gt;57016&lt;/<span style="color:#000080">td</span>&gt;
&lt;<span style="color:#000080">td</span> <span style="color:#008080">style</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;width:10%;&#34;</span>&gt;219169846&lt;/<span style="color:#000080">td</span>&gt;
&lt;<span style="color:#000080">td</span> <span style="color:#008080">style</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;width:6%;&#34;</span>&gt;2019-01-12 11:32:01&lt;/<span style="color:#000080">td</span>&gt;
&lt;<span style="color:#000080">td</span> <span style="color:#008080">style</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;width:6%;&#34;</span>&gt;é•¿å³™å­¦ç”Ÿå®¿èˆP&lt;/<span style="color:#000080">td</span>&gt;
&lt;<span style="color:#000080">td</span> <span style="color:#008080">style</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;width:10%;&#34;</span>&gt;å•†åŠ¡æ”¶è´¹&lt;/<span style="color:#000080">td</span>&gt;
&lt;<span style="color:#000080">td</span> <span style="color:#008080">style</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;width:8%;&#34;</span>&gt;-5&lt;/<span style="color:#000080">td</span>&gt;
&lt;<span style="color:#000080">td</span> <span style="color:#008080">style</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;width:8%;&#34;</span>&gt;38.61&lt;/<span style="color:#000080">td</span>&gt;&lt;/<span style="color:#000080">tr</span>&gt;&lt;/<span style="color:#000080">tbody</span>&gt;
&lt;/<span style="color:#000080">table</span>&gt;
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#000;font-weight:bold">val</span> table = doc.getElementById(<span style="color:#d14">&#34;queryGridPluto_inte_jyxx_&#34;</span>)
<span style="color:#000;font-weight:bold">val</span> rows = table.select(<span style="color:#d14">&#34;tr&#34;</span>)
<span style="color:#000;font-weight:bold">for</span> (i <span style="color:#000;font-weight:bold">in</span> <span style="color:#099">1</span> until rows.size) {
  <span style="color:#000;font-weight:bold">val</span> cols = rows[i].select(<span style="color:#d14">&#34;td&#34;</span>)
	<span style="color:#998;font-style:italic">//...
</span><span style="color:#998;font-style:italic"></span>}
</code></pre></div><p>äº¤æ˜“æµæ°´å·ã€äº¤æ˜“æ—¶é—´ã€å•†æˆ·ä»£ç ã€äº¤æ˜“é‡‘é¢éƒ½æ˜¯æˆ‘ä»¬éœ€è¦çš„æ•°æ®ï¼Œåˆ†åˆ«å¯¹å…¶è¿›è¡Œæå–å’Œæçº¯ï¼š</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">    <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">val</span> regex1 = Regex(<span style="color:#d14">&#34;(æ¶ˆè´¹æœº|åŒåŠ›|å¤šåª’ä½“)[0-9]*&#34;</span>)
    <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">val</span> regexToRemoveNum = Regex(<span style="color:#d14">&#34;[0-9]+&#34;</span>)
    <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">fun</span> <span style="color:#900;font-weight:bold">parseCardTable</span>(responseString: String, pageSize: Int): ArrayList&lt;ECard&gt;? {
        <span style="color:#000;font-weight:bold">if</span> (responseString.isEmpty()) {
            <span style="color:#000;font-weight:bold">return</span> <span style="color:#000;font-weight:bold">null</span>
        }
        <span style="color:#000;font-weight:bold">val</span> itemList = ArrayList&lt;ECard&gt;(pageSize)
        <span style="color:#000;font-weight:bold">val</span> doc = Jsoup.parse(responseString)
        <span style="color:#000;font-weight:bold">val</span> table = doc.getElementById(<span style="color:#d14">&#34;queryGridPluto_inte_jyxx_&#34;</span>)
        <span style="color:#000;font-weight:bold">val</span> rows = table.select(<span style="color:#d14">&#34;tr&#34;</span>)

        Util.formatSecondThreadLocal.<span style="color:#000;font-weight:bold">set</span>(SimpleDateFormat(<span style="color:#d14">&#34;yyyy-MM-dd HH:mm:ss&#34;</span>, Locale.CHINA))

        <span style="color:#000;font-weight:bold">for</span> (i <span style="color:#000;font-weight:bold">in</span> <span style="color:#099">1</span> until rows.size) {
            <span style="color:#000;font-weight:bold">val</span> cols = rows[i].select(<span style="color:#d14">&#34;td&#34;</span>)
            <span style="color:#000;font-weight:bold">var</span> money = <span style="color:#099">0.0</span>
            <span style="color:#000;font-weight:bold">try</span> {
                money = cols[<span style="color:#099">5</span>].text().toDouble()
            } <span style="color:#000;font-weight:bold">catch</span> (ignore: NumberFormatException) {
                <span style="color:#000;font-weight:bold">continue</span>
            }
            <span style="color:#000;font-weight:bold">if</span> (money <span style="color:#000;font-weight:bold">!=</span> <span style="color:#099">0.0</span>) {
                <span style="color:#000;font-weight:bold">val</span> name = prettyName(cols[<span style="color:#099">3</span>].text())
                <span style="color:#000;font-weight:bold">var</span> item: ECard? = <span style="color:#000;font-weight:bold">null</span>
                <span style="color:#000;font-weight:bold">try</span> {
                    <span style="color:#000;font-weight:bold">val</span> date = Util.getTimeDate(cols[<span style="color:#099">2</span>].text())
                    <span style="color:#000;font-weight:bold">if</span> (date <span style="color:#000;font-weight:bold">==</span> <span style="color:#000;font-weight:bold">null</span>) <span style="color:#000;font-weight:bold">continue</span>
                    item = ECard(cols[<span style="color:#099">1</span>].text().toLong(), name, date, money)
                } <span style="color:#000;font-weight:bold">catch</span> (e: ArrayIndexOutOfBoundsException) {
                    e.printStackTrace()
                    <span style="color:#000;font-weight:bold">continue</span>
                }
                itemList.add(item)
            }
        }
        <span style="color:#000;font-weight:bold">return</span> itemList
    }

    <span style="color:#000;font-weight:bold">private</span> <span style="color:#000;font-weight:bold">fun</span> <span style="color:#900;font-weight:bold">prettyName</span>(name: String): String {
        <span style="color:#000;font-weight:bold">var</span> tmp = name
        tmp = tmp.replace(regex1, <span style="color:#d14">&#34;&#34;</span>)
        tmp = tmp.replace(regexToRemoveNum, <span style="color:#d14">&#34;&#34;</span>)
        <span style="color:#000;font-weight:bold">return</span> tmp
    }
</code></pre></div><h2 id="ç”¨æˆ·ä¿¡æ¯">ç”¨æˆ·ä¿¡æ¯</h2>
<p>ç½‘ç«™çš„ä¸»é¡µåŒ…å«ä¸€äº›ç”¨æˆ·çš„ä¿¡æ¯ï¼šç­çº§ï¼Œå­¦å·ï¼Œæ ¡å›­å¡ä½™é¢ï¼Œå›¾ä¹¦å€Ÿé˜…æƒ…å†µï¼ŒåŒæ ·å¯ä»¥ç”¨ Jsoup å¯¹å…¶è¿›è¡Œæå–ï¼Œåœ¨ app ä¸­å±•ç¤ºã€‚</p>
<p>
<a data-fancybox="gallery" href="/images/book-request.png">
  <img class="mx-auto" alt="book-request" src="/images/book-request.png" />
</a>
</p>
<p>å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸€ä¸ªæ ‡ç­¾çš„ç¬¬0é¡¹æ˜¯å®ƒå’Œå®ƒæ‰€ä»¥å­æ ‡ç­¾å†…å®¹çš„åˆé›†ã€‚æ‰€ä»¥è¿™é‡Œå–ç¬¬ä¸€é¡¹ï¼š<code>val nameText = div[1].text()</code>ã€‚</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">    <span style="color:#000;font-weight:bold">fun</span> <span style="color:#900;font-weight:bold">getUserInfo</span>(): Observable&lt;User&gt; {
        <span style="color:#000;font-weight:bold">val</span> request = Request.Builder()
            .url(<span style="color:#d14">&#34;http://portal.zjou.edu.cn/index.portal&#34;</span>)
            .header(<span style="color:#d14">&#34;User-Agent&#34;</span>, USER_AGENT)
            .<span style="color:#000;font-weight:bold">get</span>()
            .build()
        <span style="color:#000;font-weight:bold">return</span> Observable.fromCallable {
            <span style="color:#000;font-weight:bold">val</span> response = httpClient.newCall(request).execute()
            <span style="color:#000;font-weight:bold">val</span> user = User(<span style="color:#099">0</span>, <span style="color:#d14">&#34;&#34;</span>)
            <span style="color:#000;font-weight:bold">val</span> resp = response.body()<span style="color:#000;font-weight:bold">?.</span>string()
            <span style="color:#000;font-weight:bold">if</span> (resp.isNullOrEmpty()) {
                user
            } <span style="color:#000;font-weight:bold">else</span> {
                <span style="color:#000;font-weight:bold">val</span> doc = Jsoup.parse(resp)
                <span style="color:#000;font-weight:bold">var</span> div: Elements? = <span style="color:#000;font-weight:bold">null</span>
                <span style="color:#000;font-weight:bold">try</span> {
                    div = doc.getElementsByClass(<span style="color:#d14">&#34;user_info&#34;</span>)[<span style="color:#099">0</span>].allElements
                } <span style="color:#000;font-weight:bold">catch</span> (ignore: Exception) {
                    <span style="color:#000;font-weight:bold">return</span><span style="color:#3c5d5d;font-weight:bold">@fromCallable</span> user
                }

                <span style="color:#998;font-style:italic">// index 0 is all content text in the div
</span><span style="color:#998;font-style:italic"></span>                Log.d(TAG, <span style="color:#d14">&#34;nameText: </span><span style="color:#d14">${div!![1].text()}</span><span style="color:#d14">&#34;</span>)
                <span style="color:#000;font-weight:bold">val</span> nameText = div[<span style="color:#099">1</span>].text().let { str <span style="color:#000;font-weight:bold">-&gt;</span>
                    <span style="color:#000;font-weight:bold">val</span> index = str.indexOfFirst { <span style="color:#000;font-weight:bold">it</span> <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;ï¼Œ&#39;</span> }
                    str.substring(<span style="color:#099">0</span>, index)
                }
                Log.d(TAG, <span style="color:#d14">&#34;name: </span><span style="color:#d14">$nameText</span><span style="color:#d14">&#34;</span>)

                Log.d(TAG, <span style="color:#d14">&#34;idText: </span><span style="color:#d14">${div[2].text()}</span><span style="color:#d14">&#34;</span>)
                <span style="color:#000;font-weight:bold">val</span> idText = div[<span style="color:#099">2</span>].text().let { str <span style="color:#000;font-weight:bold">-&gt;</span>
                    <span style="color:#000;font-weight:bold">val</span> index = str.indexOfFirst { <span style="color:#000;font-weight:bold">it</span> <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;ï¼š&#39;</span> }
                    str.substring(index + <span style="color:#099">1</span>, str.length)
                }
                Log.d(TAG, <span style="color:#d14">&#34;id: </span><span style="color:#d14">$idText</span><span style="color:#d14">&#34;</span>)

                Log.d(TAG, <span style="color:#d14">&#34;classText: </span><span style="color:#d14">${div[3].text()}</span><span style="color:#d14">&#34;</span>)
                <span style="color:#000;font-weight:bold">val</span> classText = div[<span style="color:#099">3</span>].text().let { str <span style="color:#000;font-weight:bold">-&gt;</span>
                    <span style="color:#000;font-weight:bold">val</span> index = str.indexOfFirst { <span style="color:#000;font-weight:bold">it</span> <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;ï¼š&#39;</span> }
                    str.substring(index + <span style="color:#099">1</span>, str.length)
                }
                Log.d(TAG, <span style="color:#d14">&#34;class: </span><span style="color:#d14">$classText</span><span style="color:#d14">&#34;</span>)

                <span style="color:#000;font-weight:bold">val</span> cardLi = doc.getElementsByClass(<span style="color:#d14">&#34;ykt&#34;</span>)
                <span style="color:#000;font-weight:bold">val</span> libraryLi = doc.getElementsByClass(<span style="color:#d14">&#34;tsg&#34;</span>)
                <span style="color:#000;font-weight:bold">val</span> bookRentTexts = libraryLi[<span style="color:#099">0</span>].allElements[<span style="color:#099">0</span>].text().split(<span style="color:#d14">&#34; &#34;</span>)

                <span style="color:#000;font-weight:bold">var</span> moneyRem = <span style="color:#099">0.0</span>
                <span style="color:#000;font-weight:bold">var</span> bookRentNum = <span style="color:#099">0</span>
                <span style="color:#000;font-weight:bold">var</span> bookRentOutDateNum = <span style="color:#099">0</span>
                <span style="color:#000;font-weight:bold">try</span> {
                    moneyRem = cardLi[<span style="color:#099">0</span>].allElements[<span style="color:#099">0</span>].text().filter { <span style="color:#000;font-weight:bold">it</span>.isDigit() <span style="color:#000;font-weight:bold">||</span> <span style="color:#000;font-weight:bold">it</span> <span style="color:#000;font-weight:bold">==</span> <span style="color:#d14">&#39;.&#39;</span> }.toDouble()
                    bookRentNum = bookRentTexts[<span style="color:#099">1</span>].toInt()
                    bookRentOutDateNum = bookRentTexts[<span style="color:#099">2</span>].filter { <span style="color:#000;font-weight:bold">it</span>.isDigit() }.toInt()
                } <span style="color:#000;font-weight:bold">catch</span> (ignore: NumberFormatException) {
                }

                User(idText.toInt(), <span style="color:#d14">&#34;&#34;</span>, nameText, classText, moneyRem, bookRentNum, bookRentOutDateNum)
            }
        }
            .subscribeOn(Schedulers.io())
            .observeOn(AndroidSchedulers.mainThread())
    }
</code></pre></div>
        </div>

        


        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/post/android_fundamental_toc/">ã€Android åŸºç¡€ã€‘å­¦ä¹ è®¡åˆ’</a></li>
        
        <li><a href="/post/android-activity/">Android å››å¤§ç»„ä»¶ï¼šActivity</a></li>
        
        <li><a href="/post/tree2view_final_report/">Android Tree2View 3-Core Alogrithm</a></li>
        
        <li><a href="/post/my_treeview_2_adapder/">Android Tree2View 2-Adapter in Tree2View</a></li>
        
        <li><a href="/post/my_treeview_1/">Android Tree2View 1-Introduction</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='https://leer.moe/tags/android'>Android</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "LeeReindeer/LeeReindeer.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>

                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='//www.google.com/search' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://leer.moe/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>

    <section class="widget">
        <h3 class="widget-title">æœ€è¿‘æ–‡ç« </h3>
<ul class="widget-list">
    
    <li>
        <a href="https://leer.moe/post/newsletter2/" title="Newsletter 002.ã€Œè™å¹´å¿«ä¹ã€">Newsletter 002.ã€Œè™å¹´å¿«ä¹ã€</a>
    </li>
    
    <li>
        <a href="https://leer.moe/post/newsletter1/" title="Newsletter 001.ã€Œæ¸©æ•…çŸ¥æ–°ã€">Newsletter 001.ã€Œæ¸©æ•…çŸ¥æ–°ã€</a>
    </li>
    
    <li>
        <a href="https://leer.moe/post/byte-pingan-hi-alipay/" title="å†è§å¹³å®‰ï¼Œä½ å¥½æ”¯ä»˜å®">å†è§å¹³å®‰ï¼Œä½ å¥½æ”¯ä»˜å®</a>
    </li>
    
    <li>
        <a href="https://leer.moe/post/pattern-of-distributed-system-1-consistent-core/" title="åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡æ¨¡å¼-åˆ†å¸ƒå¼å…±è¯†æ ¸å¿ƒ">åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡æ¨¡å¼-åˆ†å¸ƒå¼å…±è¯†æ ¸å¿ƒ</a>
    </li>
    
    <li>
        <a href="https://leer.moe/post/intro-macos/" title="macOS å…¥é—¨ ğŸ˜">macOS å…¥é—¨ ğŸ˜</a>
    </li>
    
    <li>
        <a href="https://leer.moe/post/pattern-of-distribeted-system-0/" title="åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡æ¨¡å¼-ç»¼è¿°">åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡æ¨¡å¼-ç»¼è¿°</a>
    </li>
    
    <li>
        <a href="https://leer.moe/post/consumer_less_create_more/" title="å°‘æ¶ˆè´¹ï¼Œå¤šåˆ›é€ ï¼Œæ›´å¿«ä¹">å°‘æ¶ˆè´¹ï¼Œå¤šåˆ›é€ ï¼Œæ›´å¿«ä¹</a>
    </li>
    
    <li>
        <a href="https://leer.moe/post/plague/" title="ã€Œé¼ ç–«ã€è¯»åæ„Ÿ">ã€Œé¼ ç–«ã€è¯»åæ„Ÿ</a>
    </li>
    
    <li>
        <a href="https://leer.moe/post/doublethink/" title="ã€Œ1984ã€è¯»åæ„Ÿ">ã€Œ1984ã€è¯»åæ„Ÿ</a>
    </li>
    
    <li>
        <a href="https://leer.moe/post/6.824_mapreduce/" title="MapReduce 6.824">MapReduce 6.824</a>
    </li>
    
</ul>
    </section>

    

    <section class="widget">
        <h3 class="widget-title"><a href="/categories">åˆ†ç±»</a></h3>
<ul class="widget-list">
    
    
    
    <li><a href="https://leer.moe/categories/newsletter/">Newsletter (2)</a></li>
    
    
    <li><a href="https://leer.moe/categories/%E5%88%9B%E4%BD%9C%E9%9B%86/">åˆ›ä½œé›† (14)</a></li>
    
    
    <li><a href="https://leer.moe/categories/%E5%AE%9E%E9%AA%8C%E5%AE%A4/">å®éªŒå®¤ (11)</a></li>
    
    
    <li><a href="https://leer.moe/categories/%E7%BF%BB%E8%AF%91%E9%9B%86/">ç¿»è¯‘é›† (6)</a></li>
    
    
    <li><a href="https://leer.moe/categories/%E8%87%AA%E4%B9%A0%E5%AE%A4/">è‡ªä¹ å®¤ (36)</a></li>
    
    
    <li><a href="https://leer.moe/categories/%E9%9A%8F%E7%AC%94%E9%9B%86/">éšç¬”é›† (13)</a></li>
    
    
    
    <li><a href="#">æœªåˆ†ç±»
            (3)</a>
    </li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>æ ‡ç­¾</a></h3>








<div class="tagcloud">
    
    
    
    
    
    <a href="https://leer.moe/tags/6.824/" style="font-size:0.8rem">6.824</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/android/" style="font-size:1.4295320036582306rem">Android</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/c/" style="font-size:1.3796618766207391rem">C</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/csapp/" style="font-size:0.8rem">CSAPP</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/distributed-system/" style="font-size:0.8rem">Distributed system</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/git/" style="font-size:1.0242438242175755rem">git</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/java/" style="font-size:1.7849500560613945rem">Java</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/javafx/" style="font-size:0.8rem">JavaFX</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/java%E5%B9%B6%E5%8F%91/" style="font-size:1.2484876484351508rem">Javaå¹¶å‘</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/jvm/" style="font-size:0.8rem">JVM</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/kotlin/" style="font-size:1.0242438242175755rem">Kotlin</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/macos/" style="font-size:0.8rem">macOS</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/manjaro/" style="font-size:0.8rem">Manjaro</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/minecraft/" style="font-size:0.8rem">Minecraft</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/mybatis/" style="font-size:0.8rem">MyBatis</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/os/" style="font-size:1.3796618766207391rem">OS</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/rtos/" style="font-size:0.8rem">RTOS</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/spring/" style="font-size:1.2484876484351508rem">Spring</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/spring-boot/" style="font-size:0.8rem">Spring Boot</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/telegram/" style="font-size:0.8rem">Telegram</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/v2ray/" style="font-size:0.8rem">V2ray</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/work/" style="font-size:0.8rem">Work</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/" style="font-size:1.0242438242175755rem">åˆ†å¸ƒå¼ç³»ç»Ÿ</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/" style="font-size:0.8rem">å¹´ç»ˆæ€»ç»“</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/%E5%BE%AE%E4%BF%A1/" style="font-size:1.3796618766207391rem">å¾®ä¿¡</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/%E6%8A%80%E5%B7%A7/" style="font-size:0.8rem">æŠ€å·§</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size:1.2484876484351508rem">æ•°æ®ç»“æ„</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/%E7%9E%8E%E6%8A%98%E8%85%BE/" style="font-size:1.3796618766207391rem">çæŠ˜è…¾</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/%E7%AE%97%E6%B3%95/" style="font-size:1.2484876484351508rem">ç®—æ³•</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/" style="font-size:0.8rem">ç¼–è¯‘åŸç†</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/%E7%BF%BB%E8%AF%91/" style="font-size:1.1554180524031636rem">ç¿»è¯‘</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size:1.2484876484351508rem">è®¾è®¡æ¨¡å¼</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/%E8%AF%BB%E4%B9%A6/" style="font-size:1.3796618766207391rem">è¯»ä¹¦</a>
    
    
    
    
    
    <a href="https://leer.moe/tags/%E9%9A%8F%E7%AC%94/" style="font-size:1.2484876484351508rem">éšç¬”</a>
    
</div>
    </section>

    

    <section class="widget">
        <h3 class="widget-title">å…¶å®ƒ</h3>
        <ul class="widget-list">
            <li><a href="https://leer.moe/index.xml">æ–‡ç«  RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
    <footer id="footer">
    <div class="container">
        &copy; 2022 <a href="https://leer.moe/">LeeReindeer&#39;s blog</a>.
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io" target="_blank">Hugo</a>
        <a href="https://github.com/LeeReindeer/maupassant-hugo" target="_blank">maupassant</a>.
        
    </div>
    <div class="container" id="showDays"></div>
</footer>
<script type="text/javascript" src='/js/sitedate.js' async=""></script>





<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>








<script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "ed681cb7afd944b3befe979a9f047e05"}'></script>

</body>

</html>